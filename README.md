# Crypto Watcher (Bun)

Простой, настраиваемый инструмент командной строки для мониторинга цен на криптовалюту из терминала, построенный с использованием Bun и TypeScript. Приложение имеет модульную архитектуру, которая облегчает расширение и поддержку.

## Возможности

- **Обзор мирового рынка:** Отображает ключевые глобальные метрики криптовалютного рынка (рыночная капитализация, объем за 24 часа, доминирование BTC, **Индекс страха и жадности**) с 24-часовыми изменениями и цветовым кодированием при запуске приложения.
- Получает цены на криптовалюту в реальном времени из API **Binance**.
- **Постоянное хранение данных:** Использует SQLite для сохранения истории цен, счетчика запусков и предыдущих состояний между перезапусками приложения.
- **Разделение сред:** Автоматически использует отдельные файлы SQLite для разработки (`dev_history.sqlite`) и продакшена (`prod_history.sqlite`).
- **Расширенный анализ цен:** Отслеживает процентные изменения за 1 минуту (или настроенный интервал), 15 минут, 30 минут и за всю сессию.
- **Индикатор торговых сигналов:** Предоставляет простые сигналы ("Buy", "Sell", "Neutral") на основе быстрых изменений цен. (**Внимание:** Это не финансовый совет и не должен использоваться для реальной торговли.)
- Настраиваемый список криптовалют для отслеживания.
- Настраиваемый интервал получения данных (поддерживает секунды, минуты и часы).
- **Выровненный и цветной вывод** для лучшей читаемости и визуальной согласованности.

## Предварительные требования

- [Bun](https://bun.com) (v1.3.8 или новее)

## Установка

1.  Клонируйте репозиторий:

    ```bash
    git clone https://github.com/k4d/crypto-watcher-bun.git
    cd crypto-watcher-bun
    ```

2.  Установите зависимости:
    ```bash
    bun install
    ```

3.  **Настройка переменных окружения:**
    Создайте файлы `.env.development` и `.env.production` в корне проекта. Bun автоматически загрузит их в зависимости от `NODE_ENV`.
    -   `.env.development`:
            ```
            BUN_ENV=development
            CMC_API_KEY=YOUR_COINMARKETCAP_API_KEY
            ```
            -   `.env.production`:
                ```
                BUN_ENV=production
                CMC_API_KEY=YOUR_COINMARKETCAP_API_KEY
                ```
            
            **Получение CMC_API_KEY:**
            1.  Зарегистрируйтесь на сайте CoinMarketCap для разработчиков: [pro.coinmarketcap.com](https://pro.coinmarketcap.com/).
            2.  Выберите бесплатный "Basic" план.
            3.  Сгенерируйте свой API-ключ в личном кабинете.
            4.  Замените `YOUR_COINMARKETCAP_API_KEY` на полученный ключ.
            
            **Важно:** Убедитесь, что ваш ключ API CoinMarketCap установлен как переменная окружения, иначе функционал глобальных метрик будет недоступен.
4.  **Инициализация базы данных:**
    При первом запуске приложение автоматически создаст файл базы данных SQLite (`dev_history.sqlite` или `prod_history.sqlite`) и необходимые таблицы.

## Структура проекта

Проект организован в модульную структуру для лучшей поддерживаемости и масштабируемости:

```
/crypto-watcher-bun
├── data/                        # Папка для хранения файлов базы данных SQLite (dev_history.sqlite, prod_history.sqlite)
├── src/
│   ├── api/                     # Модули для взаимодействия с внешними API (например, Binance)
│   │   ├── binance.ts           # Клиент Binance API
│   │   ├── coinmarketcap.ts     # Клиент CoinMarketCap API
│   │   └── index.ts             # Агрегатор для API-клиентов
│   ├── config/                  # Модуль для загрузки и управления конфигурацией
│   │   └── index.ts             # Логика загрузки и обработки config.yml
│   ├── db.ts                    # Модуль для инициализации и управления базой данных SQLite
│   ├── display/                 # Модуль для форматирования и вывода информации в консоль
│   │   ├── formatters.ts        # Вспомогательные функции для форматирования данных (например, formatPrice)
│   │   ├── globalMetricsDisplay.ts # Логика отображения глобальных метрик (CoinMarketCap)
│   │   ├── index.ts             # Основная логика для отображения таблицы цен
│   │   ├── logMessages.ts       # Вспомогательные функции для логирования сообщений (старт, ошибки)
│   │   └── stateHelpers.ts      # Вспомогательные функции для работы с состоянием приложения в БД (getState, setState)
│   ├── scheduler/               # Модуль для настройки и управления cron-заданиями
│   │   └── index.ts             # Логика планировщика
│   ├── types/                   # Централизованные определения общих типов и интерфейсов
│   │   └── index.ts             # Все общие типы
│   └── index.ts                 # Главный файл приложения (оркестратор)
├── config.yml                   # Файл конфигурации приложения
├── package.json                 # Описание проекта и скрипты
├── tsconfig.json                # Конфигурация TypeScript
├── biome.json                   # Конфигурация Biome для форматирования и линтинга
├── .env.development             # Переменные окружения для разработки
├── .env.production              # Переменные окружения для продакшена
└── README.md                    # Документация проекта
```

## Конфигурация

1.  Создайте файл `config.yml` в **корне проекта**.
2.  Добавьте желаемую конфигурацию. Здесь приведен пример:

    ```yaml
    ---
    currency: USDT
    fetch_interval: 3m # Интервал, с которым запрашивать новые цены (s: секунды, m: минуты, h: часы)
    coins:
      BTCUSDT: BTC
      ETHUSDT: ETH
      ZILUSDT: ZIL
      TONUSDT: TON
      TRXUSDT: TRX
      ZECUSDT: ZEC
      LUNA2USDT: LUNA2
    ```

## Использование

### Запуск в режиме разработки

Для запуска приложения в режиме разработки с автоматической перезагрузкой при изменениях файлов:

```bash
bun run dev
```

### Запуск продакшен-версии

1.  **Создайте продакшен-сборку:**

    ```bash
    bun run build
    ```

2.  **Запустите скомпилированное приложение:**
    ```bash
    bun run start:prod
    ```

Приложение выполнит первоначальную выборку, а затем продолжит получать цены с интервалом, указанным в `config.yml`.

### Очистка данных SQLite

Чтобы сбросить всю историю цен и счетчики, просто удалите соответствующий файл базы данных SQLite:

-   Для разработки: `rm dev_history.sqlite`
-   Для продакшена: `rm prod_history.sqlite`

При следующем запуске приложение автоматически создаст новый файл базы данных.

### Пример вывода

```
Crypto Watcher v1.2.0 started. Initial fetch...
┌───┬──────────────────┬─────────────┬────────────┐
│   │ Metric           │ Value       │ 24h Change │
├───┼──────────────────┼─────────────┼────────────┤
│ 1 │ Total Market Cap │ 2.34T   USD │ ▼ -0.78%   │
│ 2 │ 24h Volume       │ 113.06B USD │ ▲ +8.76%   │
│ 3 │ BTC Dominance    │ 58.74   %   │ ▲ +0.05%   │
└───┴──────────────────┴─────────────┴────────────┘

[33] Task run at 6:22:37 PM
┌───┬────────────┬─────────┬─────────────────────────┬────────────────────────────────┬────┬─────────┐
│   │ Symbol     │ Price   │ 24h High/Low/AVG        │ % Change 5m/15m/30m/Session    │ V# │ Signal  │
├───┼────────────┼─────────┼─────────────────────────┼────────────────────────────────┼────┼─────────┤
│ 1 │ BTC   USDT │ 69083.6 │ 71126.0 67800.0 69590.9 │ ▲ +0.01% ▲ +0.61% N/A ▼ -0.13% │ 5  │ Neutral │
│ 2 │ ETH   USDT │ 2024.15 │ 2147.73 1989.38 2056.38 │ ▲ +0.05% ▲ +0.75% N/A ▼ -0.64% │ 4  │ Neutral │
│ 3 │ TON   USDT │ 1.351   │ 1.385   1.335   1.356   │ ▼ -0.07% ▲ +0.52% N/A ▲ +0.37% │ 3  │ Neutral │
│ 4 │ TRX   USDT │ 0.2779  │ 0.2804  0.2762  0.2781  │    0.00% ▼ -0.04% N/A ▲ +0.14% │ 6  │ Neutral │
│ 5 │ ZEC   USDT │ 235.73  │ 245.33  231.95  239.23  │ ▼ -0.10% ▲ +0.79% N/A ▲ +0.83% │ 2  │ Neutral │
│ 6 │ ZIL   USDT │ 0.00419 │ 0.00451 0.00412 0.00429 │    0.00% ▲ +0.48% N/A ▼ -8.32% │ 7  │ Neutral │
│ 7 │ LUNA2 USDT │ 0.0612  │ 0.0628  0.0601  0.0613  │ ▲ +0.16% ▲ +0.49% N/A ▲ +0.49% │ 1  │ Neutral │
└───┴────────────┴─────────┴─────────────────────────┴────────────────────────────────┴────┴─────────┘
Scheduler started: fetching every 5m
```