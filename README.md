# Crypto Watcher (Bun)

Простой, настраиваемый инструмент командной строки для мониторинга цен на криптовалюту из терминала, построенный с использованием Bun и TypeScript. Приложение имеет модульную архитектуру, которая облегчает расширение и поддержку.

## Возможности

- **Обзор мирового рынка:** Отображает ключевые глобальные метрики криптовалютного рынка (рыночная капитализация, объем за 24 часа, доминирование BTC, **доминирование ETH**, **другие альткоины** и **Индекс страха и жадности с цветовым кодированием**) с 24-часовыми изменениями и цветовым кодированием при запуске приложения.
- **Модульная и компонентная архитектура:** Система отображения сообщений построена на основе переиспользуемых компонентов, что улучшает модульность и упрощает управление выводом в консоль.
- Получает цены на криптовалюту в реальном времени из API **Binance**.
- **Постоянное хранение данных:** Использует SQLite для сохранения истории цен, счетчика запусков и предыдущих состояний между перезапусками приложения.
- **Разделение сред:** Автоматически использует отдельные файлы SQLite для разработки (`dev_history.sqlite`) и продакшена (`prod_history.sqlite`).
- **Расширенный анализ цен:** Отслеживает процентные изменения за 1 минуту (или настроенный интервал), 15 минут, 30 минут и за всю сессию.
- **Индикатор торговых сигналов:** Предоставляет простые сигналы ("Buy", "Sell", "Neutral") на основе быстрых изменений цен. (**Внимание:** Это не финансовый совет и не должен использоваться для реальной торговли.)
- Настраиваемый список криптовалют для отслеживания.
- Настраиваемый интервал получения данных (поддерживает секунды, минуты и часы).
- **Выровненный и цветной вывод** для лучшей читаемости и визуальной согласованности.

## Предварительные требования

- [Bun](https://bun.com) (v1.3.8 или новее)

## Установка

1.  Клонируйте репозиторий:

    ```bash
    git clone https://github.com/k4d/crypto-watcher-bun.git
    cd crypto-watcher-bun
    ```

2.  Установите зависимости:
    ```bash
    bun install
    ```

3.  **Настройка переменных окружения:**
    Создайте файлы `.env.development` и `.env.production` в корне проекта. Bun автоматически загрузит их в зависимости от `NODE_ENV`.
    -   `.env.development`:
            ```
            BUN_ENV=development
            CMC_API_KEY=YOUR_COINMARKETCAP_API_KEY
            ```
            -   `.env.production`:
                ```
                BUN_ENV=production
                CMC_API_KEY=YOUR_COINMARKETCAP_API_KEY
                ```
            
            **Получение CMC_API_KEY:**
            1.  Зарегистрируйтесь на сайте CoinMarketCap для разработчиков: [pro.coinmarketcap.com](https://pro.coinmarketcap.com/).
            2.  Выберите бесплатный "Basic" план.
            3.  Сгенерируйте свой API-ключ в личном кабинете.
            4.  Замените `YOUR_COINMARKETCAP_API_KEY` на полученный ключ.
            
            **Важно:** Убедитесь, что ваш ключ API CoinMarketCap установлен как переменная окружения, иначе функционал глобальных метрик будет недоступен.
4.  **Инициализация базы данных:**
    При первом запуске приложение автоматически создаст файл базы данных SQLite (`dev_history.sqlite` или `prod_history.sqlite`) и необходимые таблицы.

## Структура проекта

Проект организован в модульную структуру для лучшей поддерживаемости и масштабируемости:

```
/crypto-watcher-bun
├── data/                        # Папка для хранения файлов базы данных SQLite (dev_history.sqlite, prod_history.sqlite)
├── src/
│   ├── api/                     # Модули для взаимодействия с внешними API (например, Binance)
│   │   ├── binance.ts           # Клиент Binance API
│   │   ├── coinmarketcap.ts     # Клиент CoinMarketCap API
│   │   └── index.ts             # Агрегатор для API-клиентов
│   ├── config/                  # Модуль для загрузки и управления конфигурацией
│   │   └── index.ts             # Логика загрузки и обработки config.yml
│   ├── components/              # Переиспользуемые компоненты для отображения сообщений и элементов CLI
│   ├── db.ts                    # Модуль для инициализации и управления базой данных SQLite (логирование сообщений об инициализации вынесено в компонент)
│   ├── display/                 # Модуль для форматирования и вывода информации в консоль
│   │   ├── formatters.ts        # Вспомогательные функции для форматирования данных (например, formatPrice)
│   │   ├── globalMetricsDisplay.ts # Логика отображения глобальных метрик (CoinMarketCap)
│   │   ├── index.ts             # Основная логика для отображения таблицы цен
│   │   └── stateHelpers.ts      # Вспомогательные функции для работы с состоянием приложения в БД (getState, setState)
│   ├── scheduler/               # Модуль для настройки и управления cron-заданиями
│   │   └── index.ts             # Логика планировщика
│   ├── types/                   # Централизованные определения общих типов и интерфейсов
│   │   └── index.ts             # Все общие типы
│   └── index.ts                 # Главный файл приложения (оркестратор)
├── config.yml                   # Файл конфигурации приложения
├── package.json                 # Описание проекта и скрипты
├── tsconfig.json                # Конфигурация TypeScript
├── biome.json                   # Конфигурация Biome для форматирования и линтинга
├── .env.development             # Переменные окружения для разработки
├── .env.production              # Переменные окружения для продакшена
└── README.md                    # Документация проекта
```

## Конфигурация

1.  Создайте файл `config.yml` в **корне проекта**.
2.  Добавьте желаемую конфигурацию. Здесь приведен пример:

    ```yaml
    ---
    currency: USDT
    fetch_interval: 3m # Интервал, с которым запрашивать новые цены (s: секунды, m: минуты, h: часы)
    coins:
      BTCUSDT: BTC
      ETHUSDT: ETH
      ZILUSDT: ZIL
      TONUSDT: TON
      TRXUSDT: TRX
      ZECUSDT: ZEC
      LUNA2USDT: LUNA2
    ```

## Использование

### Запуск в режиме разработки

Для запуска приложения в режиме разработки с автоматической перезагрузкой при изменениях файлов:

```bash
bun run dev
```

### Запуск продакшен-версии

1.  **Создайте продакшен-сборку:**

    ```bash
    bun run build
    ```

2.  **Запустите скомпилированное приложение:**
    ```bash
    bun run start:prod
    ```

Приложение выполнит первоначальную выборку, а затем продолжит получать цены с интервалом, указанным в `config.yml`.

### Очистка данных SQLite

Чтобы сбросить всю историю цен и счетчики, просто удалите соответствующий файл базы данных SQLite:

-   Для разработки: `rm dev_history.sqlite`
-   Для продакшена: `rm prod_history.sqlite`

При следующем запуске приложение автоматически создаст новый файл базы данных.

### Пример вывода

```
Database initialized at data/dev_history.sqlite and schema verified.
 _____        ______                 __
/__  /       / ____/______  ______  / /_____
  / /       / /   / ___/ / / / __ \/ __/ __ \
 / /__     / /___/ /  / /_/ / /_/ / /_/ /_/ /
/____/     \____/_/   \__, / .___/\__/\____/
 _       __      __  /____/_/
| |     / /___ _/ /______/ /_  ___  _____
| | /| / / __ `/ __/ ___/ __ \/ _ \/ ___/
| |/ |/ / /_/ / /_/ /__/ / / /  __/ /
|__/|__/\__,_/\__/\___/_/ /_/\___/_/

Crypto Watcher v1.4.0 started.
┌───┬────────────────────┬─────────────────────┬────────────┐
│   │ Metric             │ Value               │ 24h Change │
├───┼────────────────────┼─────────────────────┼────────────┤
│ 1 │ Total Market Cap   │ 2.28T  USD          │ ▼ -3.03%   │
│ 2 │ 24h Volume         │ 95.82B USD          │ ▼ -16.61%  │
│ 3 │ BTC Dominance      │ 58.58  %            │ ▼ -0.13%   │
│ 4 │ ETH Dominance      │ 10.28  %            │ ▼ -0.07%   │
│ 5 │ Others             │ 31.14  %            │ ▲ +0.20%   │
│ 6 │ Fear & Greed Index │ 9      Extreme fear │ N/A        │
└───┴────────────────────┴─────────────────────┴────────────┘

[64] Task run at 1:49:02 PM
┌───┬────────────┬─────────┬─────────────────────────┬─────────────────────────────────┬────┬─────────┐
│   │ Symbol     │ Price   │ 24h High/Low/AVG        │ % Change 5m/15m/30m/Session     │ V# │ Signal  │
├───┼────────────┼─────────┼─────────────────────────┼─────────────────────────────────┼────┼─────────┤
│ 1 │ BTC   USDT │ 66637.6 │ 69993.6 66558.0 68319.2 │ ▼ -0.04% ▼ -0.23% N/A ▼ -3.66%  │ 4  │ Neutral │
│ 2 │ ETH   USDT │ 1937.77 │ 2046.94 1932.02 1996.95 │ ▲ +0.13% ▼ -0.29% N/A ▼ -4.88%  │ 2  │ Neutral │
│ 3 │ TON   USDT │ 1.292   │ 1.357   1.291   1.334   │    0.00% ▼ -0.54% N/A ▼ -4.01%  │ 5  │ Neutral │
│ 4 │ TRX   USDT │ 0.2741  │ 0.2788  0.2739  0.2769  │    0.00% ▼ -0.04% N/A ▼ -1.23%  │ 6  │ Neutral │
│ 5 │ ZEC   USDT │ 225.52  │ 244.96  224.70  234.31  │ ▼ -0.12% ▼ -0.41% N/A ▼ -3.54%  │ 3  │ Neutral │
│ 6 │ ZIL   USDT │ 0.00407 │ 0.00429 0.00401 0.00416 │ ▲ +0.25%    0.00% N/A ▼ -10.94% │ 1  │ Neutral │
│ 7 │ LUNA2 USDT │ 0.0582  │ 0.0634  0.0577  0.0609  │    0.00% ▼ -0.51% N/A ▼ -4.43%  │ 7  │ Neutral │
└───┴────────────┴─────────┴─────────────────────────┴─────────────────────────────────┴────┴─────────┘
Scheduler started: fetching every 5m
```