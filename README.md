# Crypto Watcher (Bun)

Простой, настраиваемый инструмент командной строки для мониторинга цен на криптовалюту из терминала, построенный с использованием Bun и TypeScript. Приложение имеет модульную архитектуру, которая облегчает расширение и поддержку.

## Возможности

- Получает цены на криптовалюту в реальном времени из API **Binance**.
- **Постоянное хранение данных:** Использует SQLite для сохранения истории цен, счетчика запусков и предыдущих состояний между перезапусками приложения.
- **Разделение сред:** Автоматически использует отдельные файлы SQLite для разработки (`dev_history.sqlite`) и продакшена (`prod_history.sqlite`).
- **Расширенный анализ цен:** Отслеживает процентные изменения за 1 минуту (или настроенный интервал), 15 минут, 30 минут и за всю сессию.
- **Индикатор торговых сигналов:** Предоставляет простые сигналы ("Buy", "Sell", "Neutral") на основе быстрых изменений цен. (**Внимание:** Это не финансовый совет и не должен использоваться для реальной торговли.)
- Настраиваемый список криптовалют для отслеживания.
- Настраиваемый интервал получения данных (поддерживает секунды, минуты и часы).
- **Выровненный и цветной вывод** для лучшей читаемости и визуальной согласованности.

## Предварительные требования

- [Bun](https://bun.com) (v1.3.8 или новее)

## Установка

1.  Клонируйте репозиторий:

    ```bash
    git clone https://github.com/k4d/crypto-watcher-bun.git
    cd crypto-watcher-bun
    ```

2.  Установите зависимости:
    ```bash
    bun install
    ```

3.  **Настройка переменных окружения:**
    Создайте файлы `.env.development` и `.env.production` в корне проекта. Bun автоматически загрузит их в зависимости от `NODE_ENV`.
    -   `.env.development`:
        ```
        BUN_ENV=development
        ```
    -   `.env.production`:
        ```
        BUN_ENV=production
        ```

4.  **Инициализация базы данных:**
    При первом запуске приложение автоматически создаст файл базы данных SQLite (`dev_history.sqlite` или `prod_history.sqlite`) и необходимые таблицы.

## Структура проекта

Проект организован в модульную структуру для лучшей поддерживаемости и масштабируемости:

```
/crypto-watcher-bun
├── data/                        # Папка для хранения файлов базы данных SQLite (dev_history.sqlite, prod_history.sqlite)
├── src/
│   ├── api/                     # Модули для взаимодействия с внешними API (например, Binance)
│   │   ├── binance.ts           # Клиент Binance API
│   │   └── index.ts             # Агрегатор для API-клиентов
│   ├── config/                  # Модуль для загрузки и управления конфигурацией
│   │   └── index.ts             # Логика загрузки и обработки config.yml
│   ├── db.ts                    # Модуль для инициализации и управления базой данных SQLite
│   ├── display/                 # Модуль для форматирования и вывода информации в консоль
│   │   ├── formatters.ts        # Вспомогательные функции для форматирования данных (например, formatPrice)
│   │   ├── index.ts             # Основная логика для отображения таблицы цен
│   │   ├── logMessages.ts       # Вспомогательные функции для логирования сообщений (старт, ошибки)
│   │   └── stateHelpers.ts      # Вспомогательные функции для работы с состоянием приложения в БД (getState, setState)
│   ├── scheduler/               # Модуль для настройки и управления cron-заданиями
│   │   └── index.ts             # Логика планировщика
│   ├── types/                   # Централизованные определения общих типов и интерфейсов
│   │   └── index.ts             # Все общие типы
│   └── index.ts                 # Главный файл приложения (оркестратор)
├── config.yml                   # Файл конфигурации приложения
├── package.json                 # Описание проекта и скрипты
├── tsconfig.json                # Конфигурация TypeScript
├── biome.json                   # Конфигурация Biome для форматирования и линтинга
├── .env.development             # Переменные окружения для разработки
├── .env.production              # Переменные окружения для продакшена
└── README.md                    # Документация проекта
```

## Конфигурация

1.  Создайте файл `config.yml` в **корне проекта**.
2.  Добавьте желаемую конфигурацию. Здесь приведен пример:

    ```yaml
    ---
    currency: USDT
    fetch_interval: 3m # Интервал, с которым запрашивать новые цены (s: секунды, m: минуты, h: часы)
    coins:
      BTCUSDT: BTC
      ETHUSDT: ETH
      ZILUSDT: ZIL
      TONUSDT: TON
      TRXUSDT: TRX
      ZECUSDT: ZEC
      LUNA2USDT: LUNA2
    ```

## Использование

### Запуск в режиме разработки

Для запуска приложения в режиме разработки с автоматической перезагрузкой при изменениях файлов:

```bash
bun run dev
```

### Запуск продакшен-версии

1.  **Создайте продакшен-сборку:**

    ```bash
    bun run build
    ```

2.  **Запустите скомпилированное приложение:**
    ```bash
    bun run start:prod
    ```

Приложение выполнит первоначальную выборку, а затем продолжит получать цены с интервалом, указанным в `config.yml`.

### Очистка данных SQLite

Чтобы сбросить всю историю цен и счетчики, просто удалите соответствующий файл базы данных SQLite:

-   Для разработки: `rm dev_history.sqlite`
-   Для продакшена: `rm prod_history.sqlite`

При следующем запуске приложение автоматически создаст новый файл базы данных.

### Пример вывода

```
Crypto Watcher v1.1.0 started. Initial fetch...
Scheduler started: fetching every 3m

[1] Task run at 3:44:20 PM
┌───┬────────────┬─────────┬─────────────────────────┬────────────────────────────────────────┬────┬─────────┐
│   │ Symbol     │ Price   │ 24h High/Low/AVG        │ % Change 3m/15m/30m/Session            │ V# │ Signal  │
├───┼────────────┴─────────┴─────────────────────────┴────────────────────────────────────────┴────┴─────────┤
│ 1 │ BTC   USDT │ 69310.1 │ 76211.4 69163.0 72196.7 │ ▼ -0.46%       N/A       N/A       ▼ -0.46% │ 4  │ Neutral │
│ 2 │ ETH   USDT │ 2055.08 │ 2246.88 2050.49 2131.61 │ ▼ -0.49%       N/A       N/A       ▼ -0.49% │ 2  │ Neutral │
│ 3 │ TON   USDT │ 1.377   │ 1.423   1.336   1.381   │ ▼ -0.22%       N/A       N/A       ▼ -0.22% │ 5  │ Neutral │
│ 4 │ TRX   USDT │ 0.2782  │ 0.2860  0.2781  0.2824  │ ▼ -0.04%       N/A       N/A       ▼ -0.04% │ 7  │ Neutral │
│ 5 │ ZEC   USDT │ 232.02  │ 280.27  231.82  254.50  │ ▼ -0.98%       N/A       N/A       ▼ -0.98% │ 1  │ Neutral │
│ 6 │ ZIL   USDT │ 0.00478 │ 0.00614 0.00470 0.00533 │ ▼ -0.21%       N/A       N/A       ▼ -0.21% │ 6  │ Neutral │
│ 7 │ LUNA2 USDT │ 0.0631  │ 0.0673  0.0629  0.0651  │ ▼ -0.47%       N/A       N/A       ▼ -0.47% │ 3  │ Neutral │
└───┴────────────┴─────────┴─────────────────────────┴────────────────────────────────────────┴────┴─────────┘

[2] Task run at 3:45:00 PM
┌───┬────────────┬─────────┬─────────────────────────┬────────────────────────────────────────┬────┬─────────┐
│   │ Symbol     │ Price   │ 24h High/Low/AVG        │ % Change 3m/15m/30m/Session            │ V# │ Signal  │
├───┴────────────┴─────────┴─────────────────────────┴────────────────────────────────────────┴────┴─────────┤
│ 1 │ BTC   USDT │ 69348.7 │ 76211.4 69163.0 72193.2 │ ▲ +0.06%       N/A       N/A       ▼ -0.40% │ 4  │ Neutral │
│ 2 │ ETH   USDT │ 2058.39 │ 2246.88 2050.49 2131.57 │ ▲ +0.16%       N/A       N/A       ▼ -0.32% │ 1  │ Neutral │
│ 3 │ TON   USDT │ 1.378   │ 1.423   1.336   1.381   │ ▲ +0.07%       N/A       N/A       ▼ -0.14% │ 3  │ Neutral │
│ 4 │ TRX   USDT │ 0.2781  │ 0.2860  0.2781  0.2824  │ ▼ -0.04%       N/A       N/A       ▼ -0.07% │ 5  │ Neutral │
│ 5 │ ZEC   USDT │ 232.19  │ 280.27  231.82  254.13  │ ▲ +0.07%       N/A       N/A       ▼ -0.91% │ 2  │ Neutral │
│ 6 │ ZIL   USDT │ 0.00478 │ 0.00614 0.00470 0.00533 │    0.00%       N/A       N/A       ▼ -0.21% │ 6  │ Neutral │
│ 7 │ LUNA2 USDT │ 0.0631  │ 0.0673  0.0629  0.0651  │    0.00%       N/A       N/A       ▼ -0.47% │ 7  │ Neutral │
└───┴────────────┴─────────┴─────────────────────────┴────────────────────────────────────────┴────┴─────────┘